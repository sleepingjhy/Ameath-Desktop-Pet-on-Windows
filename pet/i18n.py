"""è¯¥æ¨¡å—æä¾›åº”ç”¨ç•Œé¢çš„å¤šè¯­è¨€æ–‡æ¡ˆä¸å·¥å…·å‡½æ•°ã€‚"""
# EN: Provides multilingual UI strings and helper utilities.

from __future__ import annotations

SUPPORTED_LANGUAGES = ("zh-CN", "en", "ja", "ko", "fr")

LANGUAGE_NAMES = {
    "zh-CN": "ä¸­æ–‡",
    "en": "English",
    "ja": "æ—¥æœ¬èª",
    "ko": "í•œêµ­ì–´",
    "fr": "FranÃ§ais",
}


def normalize_language(language: str | None) -> str:
    """è§„èŒƒåŒ–è¯­è¨€ä»£ç ã€‚éæ³•å€¼å›é€€ä¸ºä¸­æ–‡ã€‚"""
    """EN: Normalize language code. Invalid values fallback to zh-CN."""
    if isinstance(language, str) and language in SUPPORTED_LANGUAGES:
        return language
    return "zh-CN"


def get_language_items() -> list[tuple[str, str]]:
    """è¿”å›è¯­è¨€é€‰é¡¹åˆ—è¡¨ã€‚"""
    """EN: Return language option pairs for UI selectors."""
    return [(code, LANGUAGE_NAMES[code]) for code in SUPPORTED_LANGUAGES]


TRANSLATIONS = {
    "zh-CN": {
        "app.settings": "è®¾ç½®",
        "app.chat": "èŠå¤©",
        "app.music": "ğŸµ éŸ³ä¹",
        "app.about": "å…³äº",
        "app.open_main": "æ‰“å¼€åº”ç”¨ç•Œé¢",
        "menu.follow_mouse": "è·Ÿéšé¼ æ ‡",
        "menu.scale": "ç¼©æ”¾æ¯”ä¾‹",
        "menu.opacity": "é€æ˜åº¦",
        "menu.display_mode": "æ˜¾ç¤ºä¼˜å…ˆçº§",
        "menu.display.always_top": "å§‹ç»ˆç½®é¡¶",
        "menu.display.fullscreen_hide": "å…¶ä»–åº”ç”¨å…¨å±æ—¶éšè—",
        "menu.display.desktop_only": "ä»…åœ¨æ¡Œé¢æ˜¾ç¤º",
        "menu.multi_instance": "å¤šå¼€æ¨¡å¼",
        "menu.set_instance_count": "è®¾ç½®æ¡Œå® æ•°é‡({min_count}-{max_count})",
        "menu.autostart": "å¼€æœºè‡ªå¯",
        "menu.language": "è¯­è¨€",
        "menu.close": "å…³é—­æ¡Œå® ",
        "menu.close_current": "ä»…å…³é—­å½“å‰æ¡Œå® ",
        "menu.close_random": "å…³é—­_ä¸ªæ¡Œå® ",
        "menu.close_all": "ä¸€é”®å…³é—­æ‰€æœ‰æ¡Œå® å¹¶é€€å‡º",
        "menu.music": "ğŸµ éŸ³ä¹",
        "menu.music.prev": "â—€â—€ ä¸Šä¸€é¦–",
        "menu.music.play": "â–¶ æ’­æ”¾",
        "menu.music.pause": "â¸ æš‚åœ",
        "menu.music.next": "â–¶â–¶ ä¸‹ä¸€é¦–",
        "menu.music.mode.list": "åˆ—è¡¨å¾ªç¯",
        "menu.music.mode.single": "å•æ›²å¾ªç¯",
        "menu.music.mode.random": "éšæœºæ’­æ”¾",
        "menu.move.stop": "åœæ­¢ç§»åŠ¨",
        "menu.move.resume": "æ¢å¤ç§»åŠ¨",
        "about.language": "è¯­è¨€",
        "tray.open": "æ‰“å¼€",
        "tray.music": "ğŸµ éŸ³ä¹",
        "tray.music.no_track": "ï¼ˆæ— æ­Œæ›²ï¼‰",
        "tray.music.prev": "â—€â—€ ä¸Šä¸€é¦–",
        "tray.music.play": "â–¶ æ’­æ”¾",
        "tray.music.pause": "â¸ æš‚åœ",
        "tray.music.next": "â–¶â–¶ ä¸‹ä¸€é¦–",
        "tray.music.mode.list": "åˆ—è¡¨å¾ªç¯",
        "tray.music.mode.single": "å•æ›²å¾ªç¯",
        "tray.music.mode.random": "éšæœºæ’­æ”¾",
        "tray.exit": "é€€å‡º",
        "tray.minimized": "åº”ç”¨å·²æœ€å°åŒ–åˆ°ç³»ç»Ÿæ‰˜ç›˜ï¼Œå¯å³é”®æ‰˜ç›˜å›¾æ ‡é€‰æ‹©â€œæ‰“å¼€â€ã€‚",
        "close.title": "å…³é—­åº”ç”¨",
        "close.prompt": "è¯·é€‰æ‹©å…³é—­æ–¹å¼ï¼š",
        "close.desc": "ä½ å¯ä»¥é€€å‡ºåº”ç”¨ï¼Œæˆ–æœ€å°åŒ–åˆ°ç³»ç»Ÿæ‰˜ç›˜ç»§ç»­åå°è¿è¡Œã€‚",
        "close.remember": "è®°ä½æˆ‘çš„é€‰æ‹©",
        "close.quit": "é€€å‡ºåº”ç”¨",
        "close.tray": "æœ€å°åŒ–åˆ°æ‰˜ç›˜",
        "close.cancel": "å–æ¶ˆ",
        "common.hint": "æç¤º",
        "common.input_number": "è¯·è¾“å…¥æ•°å­—",
        "common.too_few": "æ•°é‡è¿‡å°‘",
        "common.too_many": "æ•°é‡è¿‡å¤š",
        "dialog.close_random_input": "è¯·è¾“å…¥å…³é—­æ•°é‡ï¼š",
    },
    "en": {
        "app.settings": "Settings",
        "app.chat": "Chat",
        "app.music": "ğŸµ Music",
        "app.about": "About",
        "app.open_main": "Open App Window",
        "menu.follow_mouse": "Follow Mouse",
        "menu.scale": "Scale",
        "menu.opacity": "Opacity",
        "menu.display_mode": "Display Priority",
        "menu.display.always_top": "Always on Top",
        "menu.display.fullscreen_hide": "Hide when another app is fullscreen",
        "menu.display.desktop_only": "Show on Desktop only",
        "menu.multi_instance": "Multi-instance",
        "menu.set_instance_count": "Set pet count ({min_count}-{max_count})",
        "menu.autostart": "Launch at startup",
        "menu.language": "Language",
        "menu.close": "Close Pet",
        "menu.close_current": "Close current pet only",
        "menu.close_random": "Close N pets",
        "menu.close_all": "Close all pets and exit",
        "menu.music": "ğŸµ Music",
        "menu.music.prev": "â—€â—€ Previous",
        "menu.music.play": "â–¶ Play",
        "menu.music.pause": "â¸ Pause",
        "menu.music.next": "â–¶â–¶ Next",
        "menu.music.mode.list": "List Loop",
        "menu.music.mode.single": "Single Loop",
        "menu.music.mode.random": "Shuffle",
        "menu.move.stop": "Stop Moving",
        "menu.move.resume": "Resume Moving",
        "about.language": "Language",
        "tray.open": "Open",
        "tray.music": "ğŸµ Music",
        "tray.music.no_track": "(No Track)",
        "tray.music.prev": "â—€â—€ Previous",
        "tray.music.play": "â–¶ Play",
        "tray.music.pause": "â¸ Pause",
        "tray.music.next": "â–¶â–¶ Next",
        "tray.music.mode.list": "List Loop",
        "tray.music.mode.single": "Single Loop",
        "tray.music.mode.random": "Shuffle",
        "tray.exit": "Exit",
        "tray.minimized": "App is minimized to system tray. Right-click the tray icon and choose \"Open\".",
        "close.title": "Close App",
        "close.prompt": "Choose how to close:",
        "close.desc": "You can quit the app or minimize it to the system tray.",
        "close.remember": "Remember my choice",
        "close.quit": "Quit",
        "close.tray": "Minimize to tray",
        "close.cancel": "Cancel",
        "common.hint": "Notice",
        "common.input_number": "Please enter a number",
        "common.too_few": "Value is too small",
        "common.too_many": "Value is too large",
        "dialog.close_random_input": "Please enter how many pets to close:",
    },
    "ja": {
        "app.settings": "è¨­å®š",
        "app.chat": "ãƒãƒ£ãƒƒãƒˆ",
        "app.music": "ğŸµ éŸ³æ¥½",
        "app.about": "ã“ã®ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦",
        "app.open_main": "ã‚¢ãƒ—ãƒªç”»é¢ã‚’é–‹ã",
        "menu.follow_mouse": "ãƒã‚¦ã‚¹è¿½å¾“",
        "menu.scale": "æ‹¡å¤§ç‡",
        "menu.opacity": "é€æ˜åº¦",
        "menu.display_mode": "è¡¨ç¤ºå„ªå…ˆ",
        "menu.display.always_top": "å¸¸ã«æœ€å‰é¢",
        "menu.display.fullscreen_hide": "ä»–ã‚¢ãƒ—ãƒªå…¨ç”»é¢æ™‚ã«éè¡¨ç¤º",
        "menu.display.desktop_only": "ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—æ™‚ã®ã¿è¡¨ç¤º",
        "menu.multi_instance": "ãƒãƒ«ãƒèµ·å‹•",
        "menu.set_instance_count": "ãƒšãƒƒãƒˆæ•°ã‚’è¨­å®š ({min_count}-{max_count})",
        "menu.autostart": "ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—èµ·å‹•",
        "menu.language": "è¨€èª",
        "menu.close": "ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒšãƒƒãƒˆã‚’é–‰ã˜ã‚‹",
        "menu.close_current": "ç¾åœ¨ã®ãƒšãƒƒãƒˆã®ã¿é–‰ã˜ã‚‹",
        "menu.close_random": "Nä½“ã‚’é–‰ã˜ã‚‹",
        "menu.close_all": "å…¨ã¦é–‰ã˜ã¦çµ‚äº†",
        "menu.music": "ğŸµ éŸ³æ¥½",
        "menu.music.prev": "â—€â—€ å‰ã¸",
        "menu.music.play": "â–¶ å†ç”Ÿ",
        "menu.music.pause": "â¸ ä¸€æ™‚åœæ­¢",
        "menu.music.next": "â–¶â–¶ æ¬¡ã¸",
        "menu.music.mode.list": "ãƒªã‚¹ãƒˆãƒ«ãƒ¼ãƒ—",
        "menu.music.mode.single": "1æ›²ãƒªãƒ”ãƒ¼ãƒˆ",
        "menu.music.mode.random": "ã‚·ãƒ£ãƒƒãƒ•ãƒ«",
        "menu.move.stop": "ç§»å‹•åœæ­¢",
        "menu.move.resume": "ç§»å‹•å†é–‹",
        "about.language": "è¨€èª",
        "tray.open": "é–‹ã",
        "tray.music": "ğŸµ éŸ³æ¥½",
        "tray.music.no_track": "ï¼ˆæ›²ãªã—ï¼‰",
        "tray.music.prev": "â—€â—€ å‰ã¸",
        "tray.music.play": "â–¶ å†ç”Ÿ",
        "tray.music.pause": "â¸ ä¸€æ™‚åœæ­¢",
        "tray.music.next": "â–¶â–¶ æ¬¡ã¸",
        "tray.music.mode.list": "ãƒªã‚¹ãƒˆãƒ«ãƒ¼ãƒ—",
        "tray.music.mode.single": "1æ›²ãƒªãƒ”ãƒ¼ãƒˆ",
        "tray.music.mode.random": "ã‚·ãƒ£ãƒƒãƒ•ãƒ«",
        "tray.exit": "çµ‚äº†",
        "tray.minimized": "ã‚¢ãƒ—ãƒªã¯ã‚·ã‚¹ãƒ†ãƒ ãƒˆãƒ¬ã‚¤ã«æœ€å°åŒ–ã•ã‚Œã¾ã—ãŸã€‚ãƒˆãƒ¬ã‚¤ã‚¢ã‚¤ã‚³ãƒ³ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Œé–‹ãã€ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚",
        "close.title": "ã‚¢ãƒ—ãƒªã‚’é–‰ã˜ã‚‹",
        "close.prompt": "é–‰ã˜æ–¹ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š",
        "close.desc": "ã‚¢ãƒ—ãƒªã‚’çµ‚äº†ã™ã‚‹ã‹ã€ã‚·ã‚¹ãƒ†ãƒ ãƒˆãƒ¬ã‚¤ã«æœ€å°åŒ–ã§ãã¾ã™ã€‚",
        "close.remember": "é¸æŠã‚’è¨˜æ†¶ã™ã‚‹",
        "close.quit": "çµ‚äº†",
        "close.tray": "ãƒˆãƒ¬ã‚¤ã«æœ€å°åŒ–",
        "close.cancel": "ã‚­ãƒ£ãƒ³ã‚»ãƒ«",
        "common.hint": "ãƒ’ãƒ³ãƒˆ",
        "common.input_number": "æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
        "common.too_few": "å€¤ãŒå°ã•ã™ãã¾ã™",
        "common.too_many": "å€¤ãŒå¤§ãã™ãã¾ã™",
        "dialog.close_random_input": "é–‰ã˜ã‚‹æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š",
    },
    "ko": {
        "app.settings": "ì„¤ì •",
        "app.chat": "ì±„íŒ…",
        "app.music": "ğŸµ ìŒì•…",
        "app.about": "ì •ë³´",
        "app.open_main": "ì•± ì°½ ì—´ê¸°",
        "menu.follow_mouse": "ë§ˆìš°ìŠ¤ ë”°ë¼ê°€ê¸°",
        "menu.scale": "ë°°ìœ¨",
        "menu.opacity": "íˆ¬ëª…ë„",
        "menu.display_mode": "í‘œì‹œ ìš°ì„ ìˆœìœ„",
        "menu.display.always_top": "í•­ìƒ ìœ„",
        "menu.display.fullscreen_hide": "ë‹¤ë¥¸ ì•± ì „ì²´í™”ë©´ ì‹œ ìˆ¨ê¹€",
        "menu.display.desktop_only": "ë°”íƒ•í™”ë©´ì—ì„œë§Œ í‘œì‹œ",
        "menu.multi_instance": "ë‹¤ì¤‘ ì‹¤í–‰",
        "menu.set_instance_count": "í« ìˆ˜ ì„¤ì • ({min_count}-{max_count})",
        "menu.autostart": "ì‹œì‘ ì‹œ ìë™ ì‹¤í–‰",
        "menu.language": "ì–¸ì–´",
        "menu.close": "ë°ìŠ¤í¬í†± í« ë‹«ê¸°",
        "menu.close_current": "í˜„ì¬ í«ë§Œ ë‹«ê¸°",
        "menu.close_random": "Nê°œ í« ë‹«ê¸°",
        "menu.close_all": "ëª¨ë“  í« ë‹«ê³  ì¢…ë£Œ",
        "menu.music": "ğŸµ ìŒì•…",
        "menu.music.prev": "â—€â—€ ì´ì „ ê³¡",
        "menu.music.play": "â–¶ ì¬ìƒ",
        "menu.music.pause": "â¸ ì¼ì‹œì •ì§€",
        "menu.music.next": "â–¶â–¶ ë‹¤ìŒ ê³¡",
        "menu.music.mode.list": "ëª©ë¡ ë°˜ë³µ",
        "menu.music.mode.single": "í•œ ê³¡ ë°˜ë³µ",
        "menu.music.mode.random": "ì…”í”Œ",
        "menu.move.stop": "ì´ë™ ì¤‘ì§€",
        "menu.move.resume": "ì´ë™ ì¬ê°œ",
        "about.language": "ì–¸ì–´",
        "tray.open": "ì—´ê¸°",
        "tray.music": "ğŸµ ìŒì•…",
        "tray.music.no_track": "(ê³¡ ì—†ìŒ)",
        "tray.music.prev": "â—€â—€ ì´ì „ ê³¡",
        "tray.music.play": "â–¶ ì¬ìƒ",
        "tray.music.pause": "â¸ ì¼ì‹œì •ì§€",
        "tray.music.next": "â–¶â–¶ ë‹¤ìŒ ê³¡",
        "tray.music.mode.list": "ëª©ë¡ ë°˜ë³µ",
        "tray.music.mode.single": "í•œ ê³¡ ë°˜ë³µ",
        "tray.music.mode.random": "ì…”í”Œ",
        "tray.exit": "ì¢…ë£Œ",
        "tray.minimized": "ì•±ì´ ì‹œìŠ¤í…œ íŠ¸ë ˆì´ë¡œ ìµœì†Œí™”ë˜ì—ˆìŠµë‹ˆë‹¤. íŠ¸ë ˆì´ ì•„ì´ì½˜ì„ ìš°í´ë¦­í•´ \"ì—´ê¸°\"ë¥¼ ì„ íƒí•˜ì„¸ìš”.",
        "close.title": "ì•± ë‹«ê¸°",
        "close.prompt": "ë‹«ê¸° ë°©ì‹ì„ ì„ íƒí•˜ì„¸ìš”:",
        "close.desc": "ì•±ì„ ì¢…ë£Œí•˜ê±°ë‚˜ ì‹œìŠ¤í…œ íŠ¸ë ˆì´ë¡œ ìµœì†Œí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        "close.remember": "ë‚´ ì„ íƒ ê¸°ì–µ",
        "close.quit": "ì¢…ë£Œ",
        "close.tray": "íŠ¸ë ˆì´ë¡œ ìµœì†Œí™”",
        "close.cancel": "ì·¨ì†Œ",
        "common.hint": "ì•ˆë‚´",
        "common.input_number": "ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”",
        "common.too_few": "ê°’ì´ ë„ˆë¬´ ì‘ìŠµë‹ˆë‹¤",
        "common.too_many": "ê°’ì´ ë„ˆë¬´ í½ë‹ˆë‹¤",
        "dialog.close_random_input": "ë‹«ì„ í« ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”:",
    },
    "fr": {
        "app.settings": "ParamÃ¨tres",
        "app.chat": "Chat",
        "app.music": "ğŸµ Musique",
        "app.about": "Ã€ propos",
        "app.open_main": "Ouvrir l'application",
        "menu.follow_mouse": "Suivre la souris",
        "menu.scale": "Ã‰chelle",
        "menu.opacity": "OpacitÃ©",
        "menu.display_mode": "PrioritÃ© d'affichage",
        "menu.display.always_top": "Toujours au premier plan",
        "menu.display.fullscreen_hide": "Masquer si une autre app est en plein Ã©cran",
        "menu.display.desktop_only": "Afficher uniquement sur le bureau",
        "menu.multi_instance": "Multi-instance",
        "menu.set_instance_count": "DÃ©finir le nombre ({min_count}-{max_count})",
        "menu.autostart": "Lancer au dÃ©marrage",
        "menu.language": "Langue",
        "menu.close": "Fermer le pet",
        "menu.close_current": "Fermer uniquement ce pet",
        "menu.close_random": "Fermer N pets",
        "menu.close_all": "Fermer tous les pets et quitter",
        "menu.music": "ğŸµ Musique",
        "menu.music.prev": "â—€â—€ PrÃ©cÃ©dent",
        "menu.music.play": "â–¶ Lecture",
        "menu.music.pause": "â¸ Pause",
        "menu.music.next": "â–¶â–¶ Suivant",
        "menu.music.mode.list": "Boucle liste",
        "menu.music.mode.single": "RÃ©pÃ©ter un titre",
        "menu.music.mode.random": "AlÃ©atoire",
        "menu.move.stop": "ArrÃªter",
        "menu.move.resume": "Reprendre",
        "about.language": "Langue",
        "tray.open": "Ouvrir",
        "tray.music": "ğŸµ Musique",
        "tray.music.no_track": "(Aucun morceau)",
        "tray.music.prev": "â—€â—€ PrÃ©cÃ©dent",
        "tray.music.play": "â–¶ Lecture",
        "tray.music.pause": "â¸ Pause",
        "tray.music.next": "â–¶â–¶ Suivant",
        "tray.music.mode.list": "Boucle liste",
        "tray.music.mode.single": "RÃ©pÃ©ter un titre",
        "tray.music.mode.random": "AlÃ©atoire",
        "tray.exit": "Quitter",
        "tray.minimized": "L'application est rÃ©duite dans la zone de notification. Clic droit sur l'icÃ´ne puis \"Ouvrir\".",
        "close.title": "Fermer l'application",
        "close.prompt": "Choisissez comment fermer :",
        "close.desc": "Vous pouvez quitter l'application ou la rÃ©duire dans la zone de notification.",
        "close.remember": "MÃ©moriser mon choix",
        "close.quit": "Quitter",
        "close.tray": "RÃ©duire dans la zone de notification",
        "close.cancel": "Annuler",
        "common.hint": "Info",
        "common.input_number": "Veuillez saisir un nombre",
        "common.too_few": "Valeur trop petite",
        "common.too_many": "Valeur trop grande",
        "dialog.close_random_input": "Veuillez saisir le nombre de pets Ã  fermer :",
    },
}


def tr(language: str | None, key: str, **kwargs) -> str:
    """æŒ‰è¯­è¨€è¿”å›æ–‡æ¡ˆã€‚ä¸å­˜åœ¨æ—¶å›é€€åˆ°ä¸­æ–‡ã€‚"""
    """EN: Resolve translated text by language, fallback to Chinese when missing."""
    lang = normalize_language(language)
    text = TRANSLATIONS.get(lang, {}).get(key)
    if text is None:
        text = TRANSLATIONS["zh-CN"].get(key, key)
    if kwargs:
        try:
            return text.format(**kwargs)
        except Exception:
            return text
    return text
